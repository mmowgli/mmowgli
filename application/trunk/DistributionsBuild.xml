<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE project>
<project name="Mmowgli" default="allWars" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">

	<macrodef name="deployOne">
		<attribute name="outfile"/>
		<attribute name="webxml"/>
		<sequential>
			<delete file="dist/@{outfile}"/>
			<war destfile="dist/@{outfile}" webxml="WebContent/WEB-INF/@{webxml}">
				<classes dir="build/classes"/>
				<lib dir="build/ivylibs"/>
				<fileset dir="WebContent" includes="VAADIN/**"/>
			</war>
		</sequential>
	</macrodef>

	<target name="zipVaadinDir" depends="expandVaadinJars">
		<delete file="dist/VAADIN.ZIP"/>
		<zip destfile="dist/VAADIN.ZIP" basedir="WebContent/VAADIN"/>
	</target>

	<target name="fetchlibs" description="put ivy dependencies in place">
		<delete dir="build/ivylibs/" includes="**/*"/>
		<ivy:retrieve conf="default, widgetset-compile" pattern="build/ivylibs/[artifact](-[classifier]).[ext]"/>
		<delete file="build/ivylibs/servlet-api.jar"/>  <!-- not wanted in deploy -->
		<delete file="build/ivylibs/javax.servlet.jar"/> <!-- not wanted in deploy -->
	</target>

	<!-- Our Apache/Akamai/Tomcat is setup so that anything in the VAADIN directory will be served -->
	<!-- by Apache/Akamai...the request never gets to Tomcat.  Therefore we MUST extract all stuff in the VAADIN -->
	<!-- directories of the vaadin jars into our war file that we're building here. -->
	<!-- The 4 vaadin jars which have VAADIN directories are below. -->
	<target name="expandVaadinJars" description="put selected vaadin components in VAADIN dir from distribution jars">
	  <unzip dest="WebContent">
		<patternset>
		  <include name="VAADIN/**" />
		</patternset>
		<fileset dir="build/ivylibs">
		  <include name="vaadin-server.jar" />
		  <include name="vaadin-themes.jar" /> 		  
		  <include name="vaadin-push.jar" />             <!-- not shown in latest vaadin pdf doc, but needed -->
		  <include name="vaadin-client-compiled.jar" />  <!-- use def. wid set for misc servlets -->
		</fileset>
	  </unzip>
      <delete dir="WebContent/VAADIN/themes/chameleon"/>
	  <delete dir="WebContent/VAADIN/themes/liferay"/>
	  <delete dir="WebContent/VAADIN/themes/reindeer-tests"/>
      <delete dir="WebContent/VAADIN/themes/runo"/>
  <!--<delete dir="WebContent/Vaadin/themes/valo"/> used by touchkit -->
	</target>
	
	<target name="confirmClean">
		<input message="Suggest Project->Clean then rebuild first. OK or return to continue..." />
	</target>
	<target name="bii.war"           depends="confirmClean,zipVaadinDir"> <deployOne outFile="bii.war"           webxml="bii_web.xml"          /></target>
	<target name="blackswan.war"     depends="confirmClean,zipVaadinDir"> <deployOne outFile="blackswan.war"     webxml="blackswan_web.xml"    /></target>
	<target name="darkportal.war"    depends="confirmClean,zipVaadinDir"> <deployOne outFile="darkportal.war"    webxml="darkportal_web.xml"   /></target>
	<target name="dd.war"            depends="confirmClean,zipVaadinDir"> <deployOne outFile="dd.war"            webxml="dd_web.xml"           /></target>
	<target name="insiderthreat.war" depends="confirmClean,zipVaadinDir"> <deployOne outFile="insiderthreat.war" webxml="insiderthreat_web.xml"/></target>
	<target name="nato.war"          depends="confirmClean,zipVaadinDir"> <deployOne outFile="nato.war"          webxml="nato_web.xml"         /></target>
	<target name="ndu.war"           depends="confirmClean,zipVaadinDir"> <deployOne outFile="ndu.war"           webxml="ndu_web.xml"          /></target>
	<target name="nps.war"           depends="confirmClean,zipVaadinDir"> <deployOne outFile="nps.war"           webxml="nps_web.xml"          /></target>
	<target name="nsc.war"           depends="confirmClean,zipVaadinDir"> <deployOne outFile="nsc.war"           webxml="nsc_web.xml"          /></target>
	<target name="pcc.war"           depends="confirmClean,zipVaadinDir"> <deployOne outFile="pcc.war"           webxml="pcc_web.xml"          /></target>
	<target name="piracyTest.war"    depends="confirmClean,zipVaadinDir"> <deployOne outFile="piracyTest.war"    webxml="test_piracy_web.xml"  /></target>
	<target name="training.war"      depends="confirmClean,zipVaadinDir"> <deployOne outFile="training.war"      webxml="training_web.xml"     /></target>

	<target name="allWars" depends=	
	   "bii.war,
		blackswan.war,
	    darkportal.war,
		dd.war,
		insiderthreat.war,
		nato.war,
		ndu.war,
		nps.war,
		nsc.war,
		pcc.war,
		piracyTest.war,
		training.war"/>

</project>
